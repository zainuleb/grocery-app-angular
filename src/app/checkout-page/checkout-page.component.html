<section class="item-content">
  <div class="container">
    <div class="table-section">
      <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef>Name</th>
          <td mat-cell *matCellDef="let element">{{ element.item.title }}</td>
        </ng-container>
        <ng-container matColumnDef="image">
          <th mat-header-cell *matHeaderCellDef>Image</th>
          <td mat-cell *matCellDef="let element">
            <img
              src="{{ element.item.image }}"
              alt="{{ element.item.title }}"
            />
          </td>
        </ng-container>
        <ng-container matColumnDef="price">
          <th mat-header-cell *matHeaderCellDef>Price</th>
          <td mat-cell *matCellDef="let element">$ {{ element.item.price }}</td>
        </ng-container>
        <ng-container matColumnDef="quantity">
          <th mat-header-cell *matHeaderCellDef>Quantity</th>
          <td mat-cell *matCellDef="let element">
            <div class="quanitityContainer">
              <div class="icon-container" (click)="incrementProduct(element)">
                <button mat-mini-fab color="accent">
                  <mat-icon aria-hidden="false" aria-label="Example home icon"
                    >add_circle_outline</mat-icon
                  >
                </button>
              </div>
              <div class="quantity">{{ element.quantity }}</div>
              <div class="icon-container" (click)="decrementProduct(element)">
                <button mat-mini-fab color="accent">
                  <mat-icon aria-hidden="false" aria-label="Example home icon"
                    >remove_circle_outline</mat-icon
                  >
                </button>
              </div>
            </div>
          </td>
        </ng-container>
        <ng-container matColumnDef="remove">
          <th mat-header-cell *matHeaderCellDef>Price</th>
          <td mat-cell *matCellDef="let element">
            <div class="remove-container">
              <button
                mat-mini-fab
                color="accent"
                (click)="removeHandler(element)"
              >
                <mat-icon aria-hidden="false" aria-label="Example home icon"
                  >remove_circle_outline</mat-icon
                >
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
      <div class="total-container">
        <strong>Total: ${{ cartTotal | number: "1.2-2" }}</strong>
      </div>
    </div>

    <div class="form-group">
      <!-- form header -->
      <h1>Address Form</h1>
      <!-- main form -->

      <form [formGroup]="userCheckoutForm">
        <mat-accordion class="example-headers-align">
          <mat-expansion-panel
            [expanded]="step === 0"
            (opened)="setStep(0)"
            hideToggle
          >
            <mat-expansion-panel-header>
              <mat-panel-title> Basic Information </mat-panel-title>
              <mat-panel-description>
                Fill your Name and Email details
                <mat-icon>contact_phone</mat-icon>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <div class="form-field-parallel">
              <div class="form-field-container">
                <mat-form-field appearance="fill">
                  <input
                    matInput
                    name="firstName"
                    formControlName="firstName"
                    placeholder="Enter First Name"
                    [ngClass]="{
                      'form-control': true,
                      'is-invalid': firstName.invalid && firstName.touched,
                      'is-valid': firstName.valid
                    }"
                  />
                </mat-form-field>
                <div class="invalid-container">
                  <small
                    *ngIf="firstName.errors?.['required'] && firstName.touched"
                    >Field is required</small
                  >
                  <small
                    *ngIf="firstName.errors?.['minlength'] && firstName.touched"
                    >Atleast "2" Characters Required</small
                  >
                </div>
              </div>
              <div class="form-field-container">
                <mat-form-field appearance="fill">
                  <input
                    matInput
                    name="lastName"
                    formControlName="lastName"
                    placeholder="Enter Last Name"
                    [ngClass]="{
                      'form-control': true,
                      'is-invalid': lastName.invalid && lastName.touched,
                      'is-valid': lastName.valid
                    }"
                  />
                </mat-form-field>
                <div class="invalid-container">
                  <small
                    *ngIf="lastName.errors?.['required'] && lastName.touched"
                    >Field is required</small
                  >
                  <small
                    *ngIf="lastName.errors?.['minlength'] && lastName.touched"
                    >Atleast "2" Characters Required</small
                  >
                </div>
              </div>
            </div>
            <div class="form-field-container">
              <mat-form-field class="emailfiled" appearance="fill">
                <input
                  matInput
                  name="email"
                  formControlName="email"
                  placeholder="Enter Your Email"
                  [ngClass]="{
                    'form-control': true,
                    'is-invalid': email.invalid && email.touched,
                    'is-valid': email.valid
                  }"
                />
              </mat-form-field>
              <div class="invalid-container">
                <small *ngIf="email.errors?.['required'] && email.touched"
                  >Field is required</small
                >
                <small *ngIf="email.errors?.['email'] && email.touched"
                  >Invalid Email Format</small
                >
              </div>
            </div>
          </mat-expansion-panel>
          <mat-divider></mat-divider>

          <mat-expansion-panel
            [expanded]="step === 1"
            (opened)="setStep(1)"
            hideToggle
          >
            <mat-expansion-panel-header>
              <mat-panel-title> Address Section </mat-panel-title>
              <mat-panel-description>
                Add Street, City and Other Detials of Your Address
                <mat-icon>contact_mail</mat-icon>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <div formArrayName="address">
              <div
                *ngFor="let group of addressArray.controls; let i = index"
                [formGroupName]="i"
              >
                <div class="address-heading-container">
                  <div class="address-heading-left">
                    <h4>Address {{ i + 1 }}</h4>
                  </div>

                  <div class="address-heading-right">
                    <div class="example-button-container">
                      <button mat-fab color="primary" (click)="addAddress()">
                        <mat-icon>add</mat-icon>
                      </button>
                    </div>
                    <div class="example-button-container">
                      <button mat-fab color="warn" (click)="removeAddress(i)">
                        <mat-icon>delete</mat-icon>
                      </button>
                    </div>
                  </div>
                </div>

                <div>
                  <mat-checkbox
                    class="example-margin"
                    formControlName="primaryFlg"
                    type="checkbox"
                    id="defaultCheck1"
                  >
                    Primary Address</mat-checkbox
                  >
                </div>
                <div class="form-field-container">
                  <mat-form-field class="emailfiled" appearance="fill">
                    <input
                      matInput
                      formControlName="streetAddress"
                      placeholder="Enter street address"
                      [ngClass]="{
                        'form-control': true,
                        'is-invalid':
                          group.get('streetAddress').invalid &&
                          group.get('streetAddress').touched,
                        'is-valid': group.get('streetAddress').valid
                      }"
                    />
                  </mat-form-field>
                  <div class="invalid-container">
                    <small
                      *ngIf="
                        group.get('streetAddress').invalid &&
                        group.get('streetAddress').touched
                      "
                      >Field is required</small
                    >
                  </div>
                </div>
                <div class="form-field-container">
                  <mat-form-field class="emailfiled" appearance="fill">
                    <input
                      matInput
                      formControlName="city"
                      placeholder="Enter city"
                      [ngClass]="{
                        'form-control': true,
                        'is-invalid':
                          group.get('city').invalid &&
                          group.get('city').touched,
                        'is-valid': group.get('city').valid
                      }"
                    />
                  </mat-form-field>
                  <div class="invalid-container">
                    <small
                      *ngIf="
                        group.get('city').invalid && group.get('city').touched
                      "
                      >Field is required</small
                    >
                  </div>
                </div>
                <div class="form-field-container">
                  <mat-form-field appearance="fill">
                    <mat-label>State</mat-label>
                    <mat-select
                      id="inputState"
                      formControlName="state"
                      [ngClass]="{
                        'form-control': true,
                        'is-invalid':
                          group.get('state').invalid &&
                          group.get('state').touched,
                        'is-valid': group.get('state').valid
                      }"
                    >
                      <mat-option
                        *ngFor="let item of states"
                        [value]="item"
                        placeholder="state"
                      >
                        {{ item }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                  <div class="invalid-container">
                    <small
                      *ngIf="
                        group.get('state').invalid && group.get('state').touched
                      "
                      >Field is required</small
                    >
                  </div>
                </div>
                <div class="form-field-container">
                  <mat-form-field class="emailfiled" appearance="fill">
                    <input
                      matInput
                      type="number"
                      formControlName="zipcode"
                      id="zipcode"
                      placeholder="Enter Zip Code"
                      [ngClass]="{
                        'form-control': true,
                        'is-invalid':
                          group.get('zipcode').invalid &&
                          group.get('zipcode').touched,
                        'is-valid': group.get('zipcode').valid
                      }"
                    />
                  </mat-form-field>
                  <div class="invalid-container">
                    <small
                      *ngIf="
                                  group.get('zipcode').errors?.['required'] &&
                                  group.get('zipcode').touched
                                "
                      >Field is required</small
                    >
                    <small
                      *ngIf="
                                  group.get('zipcode').errors?.['pattern'] &&
                                  group.get('zipcode').touched
                                "
                      >Value should be 5 digit number.</small
                    >
                  </div>
                </div>
              </div>
            </div>
          </mat-expansion-panel>
        </mat-accordion>

        <mat-divider></mat-divider>

        <div class="btn-container">
          <button
            mat-stroked-button
            class="submit-btn"
            [disabled]="userCheckoutForm.invalid"
            (click)="submitHandler()"
            style="
              width: 20%;
              background-color: #ff0081;
              color: white;
              font-size: 16px;
              letter-spacing: 2px;
              box-shadow: 0 2px 25px rgba(255, 0, 130, 0.5);
              cursor: pointer;
            "
          >
            Order
          </button>
        </div>
      </form>
    </div>
  </div>
</section>
